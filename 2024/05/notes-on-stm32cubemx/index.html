<!DOCTYPE html>
<html class="no-js" lang="en">
<head>

  <title>STM32CubeMX小记 &mdash; 1+1=10</title>
  <meta charset="utf-8" />
  <meta name="generator" content="Pelican" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="author" content="Debao Zhang">
    <meta name="description" content="记记笔记，放松一下..." />
    <link href="https://blog.debao.me/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="1+1=10 Full Atom Feed" />
    <link href="https://blog.debao.me/feeds/atom.xml" type="application/atom+xml" rel="alternate" title="1+1=10 Atom Feed" />
    <link href="https://blog.debao.me/feeds/ee.atom.xml" type="application/atom+xml" rel="alternate" title="1+1=10 Categories Atom Feed" />

    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" crossorigin="anonymous">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" crossorigin="anonymous"></script>
    <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN" || mathElements[i].tagName === "DIV") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
    </script>





  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">


    <link href="https://blog.debao.me/favicon.png" rel="icon">

  <link href="https://blog.debao.me/theme/css/main.css" media="screen, projection"
        rel="stylesheet" type="text/css">

</head>

<body>
  <header role="banner"><hgroup>
  <h1><a href="https://blog.debao.me/">1+1=10</a></h1>
    <h2>记记笔记，放松一下...</h2>
</hgroup></header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="https://blog.debao.me/feeds/atom.xml" rel="subscribe-atom">Atom</a></li>
</ul>

<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="blog.debao.me">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>

<ul class="main-navigation">
</ul></nav>
  <div id="main">
    <div id="content">
<div>
  <article class="hentry" role="article">
<header>
      <h1 class="entry-title">STM32CubeMX小记</h1>
    <p class="meta">
<time datetime="2024-05-30T21:01:00+08:00" pubdate>Thu 30 May 2024</time>    </p>
</header>

  <div class="entry-content"><blockquote>
<p>接前面<a href="https://blog.debao.me/2024/04/notes-on-arm-development/">ARM开发环境小记</a>与<a href="https://blog.debao.me/2024/05/notes-on-keil-mdk-community/">Keil MDK 社区版小记</a>。不求深入，简单了解一下CubeMX生成的代码的基本结构...</p>
</blockquote>
<h2 id="stm32-cubemx">STM32 CubeMX 是什么？</h2>
<p>CubeMX 是 STM32 Cube  家族一员，全家福这样：</p>
<ul>
<li>STM32CubeMX： 用于生成初始化代码和配置项目，然后在</li>
<li>STM32CubeIDE： 中编辑、编译和调试这些代码</li>
<li>STM32CubeProgrammer： 用于将编译好的程序烧写到微控制器上</li>
<li>STM32CubeMonitor： 可用于进一步的运行时分析和性能调优。</li>
</ul>
<p>类比Qt的话，CubeMX 相当于qdesigner，CubeIDE相当于Qt Creator。CubeIDE中集成了CubeMX的大部分功能，但是使用其他IDE（比如Keil MDK）时，使用CubeMX生成的代码更容易。</p>
<p>CubeMX可以为如下工具和IDE生成项目代码：</p>
<ul>
<li>EWARM</li>
<li>MDK-ARM</li>
<li>STM32CubeIDE</li>
<li>Makefile</li>
<li>CMake</li>
</ul>
<h2 id="_1">生成代码结构？</h2>
<blockquote>
<p>本文所用 STM32CubeMX 版本为6.11.1，盲选择MCU型号STM32F051C8Tx。</p>
</blockquote>
<h3 id="mdk-arm">尝试一（MDK-ARM)</h3>
<p>生成代码结构如下：</p>
<ul>
<li>顶层 .mxproject 和 MyTest.ioc： 都是 CubeMX 的工程文件。需要保留以便于后续使用Cube重新生成或更新代码【.ioc 文件代表“Initialization and Configuration”】。</li>
<li>MDK-ARM：为Keil MDK生成的项目文件（以便于在Keil下直接打开工程），以及启动文件 <code>startup_stm32f051x8.s</code>【这个文件被放在这儿，是因为它能只用于Keil MDK，不通用】</li>
<li>Core：用户需要修改的代码！！（在指定位置修改，以免后续用CubeMX更新时被覆盖）</li>
<li>Drivers：CMSIS 和 HAL库文件</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span></pre></div></td><td class="code"><div><pre><span></span><code>│  .mxproject
│  MyTest.ioc
│
├─Core
│  ├─Inc
│  │      main.h
│  │      stm32f0xx_hal_conf.h
│  │      stm32f0xx_it.h
│  │
│  └─Src
│          main.c
│          stm32f0xx_hal_msp.c
│          stm32f0xx_it.c
│          system_stm32f0xx.c
│
├─Drivers
│  ├─CMSIS
│  │  │  LICENSE.txt
│  │  │
│  │  ├─Device
│  │  │  └─ST
│  │  │      └─STM32F0xx
│  │  │          │  LICENSE.txt
│  │  │          │
│  │  │          └─Include
│  │  │                 stm32f051x8.h
│  │  │                 stm32f0xx.h
│  │  │                 system_stm32f0xx.h
│  │  └─Include
│  │          cmsis_armcc.h
│  │          cmsis_armclang.h
│  │          ...
│  │
│  └─STM32F0xx_HAL_Driver
│      │  LICENSE.txt
│      │
│      ├─Inc
│      │  │  stm32f0xx_hal.h
│      │  │  stm32f0xx_hal_cortex.h
|      |  |  ...
│      │  │
│      │  └─Legacy
│      │          stm32_hal_legacy.h
│      │
│      └─Src
│              stm32f0xx_hal.c
│              stm32f0xx_hal_cortex.c
|              .....
│
└─MDK-ARM
        MyTest.uvoptx
        MyTest.uvprojx
        startup_stm32f051x8.s
</code></pre></div></td></tr></table></div>

<p>重点关注下Core下的几个文件：</p>
<ul>
<li>main.c</li>
<li>stm32f0xx_hal_msp.c</li>
<li>stm32f0xx_it.c</li>
</ul>
<p>这几个文件内部都有大量的如下风格的注释段，用于让用户加入自定义的代码：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="w">  </span><span class="cm">/* USER CODE BEGIN xxxxx */</span>

<span class="w">  </span><span class="cm">/* USER CODE END xxxx */</span>
</code></pre></div></td></tr></table></div>

<h4 id="mainc">main.c</h4>
<ul>
<li>系统初始化：初始化硬件抽象层（HAL）、配置系统时钟。</li>
<li>外设初始化：初始化各个外设模块，例如 GPIO、USART、I2C 等。</li>
<li>主循环：包含应用程序的主逻辑，通常是一个无限循环。</li>
<li>功能实现：执行主要的应用功能，例如数据处理、通信协议等。</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;main.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;stm32f0xx_hal.h&quot;</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">SystemClock_Config</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">MX_GPIO_Init</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">MX_USART2_UART_Init</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>

<span class="n">UART_HandleTypeDef</span><span class="w"> </span><span class="n">huart2</span><span class="p">;</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">HAL_Init</span><span class="p">();</span>
<span class="w">    </span><span class="n">SystemClock_Config</span><span class="p">();</span>
<span class="w">    </span><span class="n">MX_GPIO_Init</span><span class="p">();</span>
<span class="w">    </span><span class="n">MX_USART2_UART_Init</span><span class="p">();</span>

<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// 主应用逻辑</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">SystemClock_Config</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// 配置系统时钟</span>
<span class="p">}</span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">MX_GPIO_Init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// 初始化 GPIO</span>
<span class="p">}</span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">MX_USART2_UART_Init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// 初始化 UART</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>

<blockquote>
<p>如果生成代码时，勾选了<code>Generate peripheral initialization as a pair of .c/.h files per peripheral</code>，各个外设的代码会生成在独立的外设文件中，比如gpio.c，uart.c  等，对应的初始化代码，比如<code>MX_GPIO_Init()</code>，将不再直接位于main.c中，而是通过include被包含进来。</p>
</blockquote>
<h4 id="stm32f0xx_hal_mspc">stm32f0xx_hal_msp.c</h4>
<blockquote>
<p>msp 表示“Microcontroller Support Package”（微控制器支持包）。这个支持包包含了一些用于初始化和配置硬件外设的底层代码。</p>
</blockquote>
<ul>
<li>外设支持包 (MSP) 配置：提供 HAL 库初始化和去初始化过程中的底层硬件配置。</li>
<li>GPIO 配置：配置用于特定外设功能的 GPIO 引脚。</li>
<li>中断配置：配置外设中断优先级和中断处理函数。</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;stm32f0xx_hal.h&quot;</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">HAL_MspInit</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// 初始化全局 MSP</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">HAL_UART_MspInit</span><span class="p">(</span><span class="n">UART_HandleTypeDef</span><span class="o">*</span><span class="w"> </span><span class="n">huart</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">huart</span><span class="o">-&gt;</span><span class="n">Instance</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">USART2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// 配置 USART2 的 MSP</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">HAL_UART_MspDeInit</span><span class="p">(</span><span class="n">UART_HandleTypeDef</span><span class="o">*</span><span class="w"> </span><span class="n">huart</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">huart</span><span class="o">-&gt;</span><span class="n">Instance</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">USART2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// 去初始化 USART2 的 MSP</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>

<h4 id="stm32f0xx_itc">stm32f0xx_it.c</h4>
<blockquote>
<p><code>it</code> 表示“Interrupt”（中断）。</p>
</blockquote>
<ul>
<li>中断服务程序 (ISR)：实现各种中断处理函数，例如定时器中断、外部中断、通信中断等。</li>
<li>系统中断处理：处理系统级中断，如 SysTick 中断。</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;main.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;stm32f0xx_it.h&quot;</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">NMI_Handler</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">   </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">){</span><span class="w"> </span><span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">HardFault_Handler</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">){</span><span class="w"> </span><span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">SVC_Handler</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">PendSV_Handler</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">SysTick_Handler</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">HAL_IncTick</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>

<h3 id="cubeide">尝试二（CubeIDE）</h3>
<p>和上面很像：</p>
<ul>
<li>都有 .mxproject 和 MyText.ioc：作为CubeMX的工程文件</li>
</ul>
<ul>
<li>Drivers 文件夹和前面完全一样</li>
</ul>
<ul>
<li>都有对应的工程文件，CubeIDE的工程文件是 .project和 .cproject【这两个文件是Eclipse IDE 及其衍生版本的配置文件】。</li>
</ul>
<ul>
<li>都有启动文件，CubeIDE的启动文件在Core文件夹内【文件内容和keil下的不一样，难怪keil下的放置到 MDK-ARM文件夹下】。</li>
</ul>
<p><strong>不同之外</strong></p>
<ul>
<li>Core下多了两个文件<code>syscalls.c</code>和 <code>sysmem.c</code>。用于实现依赖于底层硬件的C标准库功能，比如内存分配和输入输出等。另外，Keil 有自己的运行时和系统调用，所以不需要它们。</li>
</ul>
<ul>
<li>多了一个<code>STM32F051C8TX_FLASH.ld</code>文件。这是一个<strong>链接脚本文件（linker script）</strong>，用于GNU 工具链，链接脚本文件定义了 MCU 内存布局，并告诉链接器如何将编译生成的代码和数据段放置到目标设备的内存中。</li>
</ul>
<blockquote>
<p>由于其他都一样，两套IDE并存，感觉上应该没问题。</p>
</blockquote>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span></pre></div></td><td class="code"><div><pre><span></span><code>│  .cproject
│  .mxproject
│  .project
│  MyTest.ioc
│  STM32F051C8TX_FLASH.ld
│
├─Core
│  ├─Inc
│  │      main.h
│  │      stm32f0xx_hal_conf.h
│  │      stm32f0xx_it.h
│  │
│  ├─Src
│  │      main.c
│  │      stm32f0xx_hal_msp.c
│  │      stm32f0xx_it.c
│  │      syscalls.c
│  │      sysmem.c
│  │      system_stm32f0xx.c
│  │
│  └─Startup
│          startup_stm32f051c8tx.s
│
└─Drivers
</code></pre></div></td></tr></table></div>

<h3 id="cmake">尝试三（CMake)</h3>
<p>生成适用于<code>arm-none-eabi-gcc</code>的cmake工程文件。</p>
<p>所有源码文件都和为CubeIDE生成的一样，局部差异</p>
<ul>
<li>启动文件<code>startup_stm32f051x8.s</code>从Core文件夹移到根目录下（内容完全一样）。Why？</li>
</ul>
<ul>
<li><code>STM32F051C8TX_FLASH.ld</code>文件，大致一样，但是内容又不完全一样！！（是否通用？）</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span></pre></div></td><td class="code"><div><pre><span></span><code>│  .mxproject
│  CMakeLists.txt
│  CMakePresets.json
│  MyTest.ioc
│  startup_stm32f051x8.s
│  STM32F051C8Tx_FLASH.ld
│
├─cmake
│  │  gcc-arm-none-eabi.cmake
│  │
│  └─stm32cubemx
│          CMakeLists.txt
│
├─Core
│  ├─Inc
│  │      main.h
│  │      stm32f0xx_hal_conf.h
│  │      stm32f0xx_it.h
│  │
│  └─Src
│          main.c
│          stm32f0xx_hal_msp.c
│          stm32f0xx_it.c
│          syscalls.c
│          sysmem.c
│          system_stm32f0xx.c
│
└─Drivers
</code></pre></div></td></tr></table></div>

<h2 id="_2">如何生成代码？</h2>
<ul>
<li>选择MCU</li>
<li>指定引脚</li>
<li>配置时钟</li>
</ul>
<p>似乎很简单，但是由于不了解硬件，看起来很发懵...</p>
<h3 id="_3">指定引脚</h3>
<ul>
<li>直接在左侧启用相应的功能，有自动分配的引脚</li>
<li>在引脚上点击右键，可以选择引脚</li>
</ul>
<p><img alt="stm32cubemx-pinout" src="https://blog.debao.me/images/arm/stm32cubemx-pinout.png"></p>
<p>图中，系统Core部分配置了：</p>
<ul>
<li>GPIO（General-Purpose Input/Output)：通用输入输出端口。STM32 微控制器的每个引脚都可以配置为不同的功能，包括输入、输出、模拟功能或特定外设的功能。</li>
<li>NVIC（Nested Vectored Interrupt Controller）：管理和处理中断。无论是使用中断方式还是 DMA 方式进行 UART 通信，都需要正确配置 NVIC 以确保中断能够正确触发和处理。</li>
<li>RCC（Reset and Clock Control）：配置微控制器的时钟系统，包括内部和外部时钟源的选择、时钟分频、总线时钟的配置等。此处启用外部高速时钟HSE（其他 外部低速时钟LSE，内部高速时钟HSI，内部低速时钟LSI）</li>
<li>SYS（System Configuration）：配置系统级别的设置，包括中断优先级、调试接口、复位源等。图中配置了<code>SYS_SWDIO</code>和 <code>SYS_SWCLK</code>引脚，用于调试接口。</li>
</ul>
<p>外设部分配置了：</p>
<ul>
<li>SPI1</li>
<li>SPI2</li>
<li>USART1</li>
</ul>
<h3 id="_4">设置时钟</h3>
<p>出来这个图，完全不知道是什么了...</p>
<p><img alt="stm32cubemx-clock" src="https://blog.debao.me/images/arm/stm32cubemx-clock.png"></p>
<h4 id="_5">概念</h4>
<p>时钟源（Clock Sources)：</p>
<ul>
<li><strong>High Speed External (HSE) Clock</strong>：配置外部高速时钟（如晶振或外部时钟源）。</li>
<li><strong>High Speed Internal (HSI) Clock</strong>：配置内部高速时钟。</li>
<li><strong>Low Speed External (LSE) Clock</strong>：配置外部低速时钟（如 RTC 时钟源）。</li>
<li><strong>Low Speed Internal (LSI) Clock</strong>：配置内部低速时钟。</li>
</ul>
<p>系统时钟（System Clock)：</p>
<ul>
<li><strong>SYSCLK</strong>：系统时钟，是所有时钟的核心，可以由 HSE、HSI 或 PLL 产生。</li>
<li><strong>HCLK</strong>：AHB 总线时钟，用于 CPU、存储器和 DMA。</li>
<li><strong>PCLK1</strong>：APB1 总线时钟，用于低速外设。</li>
<li><strong>PCLK2</strong>：APB2 总线时钟，用于高速外设。</li>
</ul>
<p>PLL配置（Phase-Locked Loop Configuration）：</p>
<ul>
<li><strong>PLL Source</strong>：PLL 的输入时钟源（通常为 HSE 或 HSI）。</li>
<li><strong>PLL Multipliers and Dividers</strong>：配置 PLL 的倍频和分频因子，以生成所需的时钟频率。</li>
</ul>
<p>缩写：</p>
<ul>
<li>AHB（Advanced High-performance Bus）：高级高性能总线，链接高带宽和高性能外设，如DMA和存储控制器等。</li>
<li>APB（Advanced Peripheral Bus）：低带宽的外设。不同的MCU上细分不同，比如F1系列又分APB1和APB2，其中APB1通常比APB2频率低。</li>
</ul>
<h4 id="_6">配置</h4>
<ul>
<li>选择时钟源（HSE或HSI）</li>
<li>配置PLL（如果需要更高的时钟频率，使用PLL，并设置其倍频和分频因子）</li>
<li>设置总线时钟分频器（AHB、APB1、APB2等）</li>
</ul></div>
    <footer>
<p class="meta">
  <span class="byline author vcard">
    Posted by <span class="fn">
        Debao Zhang
    </span>
  </span>
<time datetime="2024-05-30T21:01:00+08:00" pubdate>Thu 30 May 2024</time>  <span class="categories">
    <a class='category' href='https://blog.debao.me/categories/ee.html'>EE</a>
  </span>
  <span class="categories">
    <a class="category" href="https://blog.debao.me/tags/stm32.html">STM32</a>  </span>
</p><div class="sharing">
</div>    </footer>
  </article>

</div>
<aside class="sidebar">
  <section>
    <h1>Recent Posts</h1>
    <ul id="recent_posts">
      <li class="post">
          <a href="https://blog.debao.me/2025/02/notes-on-bpm/">BPM 小记</a>
      </li>
      <li class="post">
          <a href="https://blog.debao.me/2025/01/a-brief-note-on-semiconductor-memory-terminology/">半导体存储器术语小记</a>
      </li>
      <li class="post">
          <a href="https://blog.debao.me/2025/01/notes-on-yizhuang-bda-and-e-town/">亦庄、经开区、亦庄新城备忘</a>
      </li>
      <li class="post">
          <a href="https://blog.debao.me/2025/01/freecad-learning-notes-2/">FreeCAD学习小记（二）</a>
      </li>
      <li class="post">
          <a href="https://blog.debao.me/2025/01/what-is-document-no.-37/">37号文是个啥？</a>
      </li>
    </ul>
  </section>
  <section>
      
    <h1>Categories</h1>
    <ul id="recent_posts">
        <li><a href="https://blog.debao.me/categories/c.html">C++</a></li>
        <li><a href="https://blog.debao.me/categories/cax.html">CAx</a></li>
        <li><a href="https://blog.debao.me/categories/ee.html">EE</a></li>
        <li><a href="https://blog.debao.me/categories/esl.html">ESL</a></li>
        <li><a href="https://blog.debao.me/categories/javascript.html">JavaScript</a></li>
        <li><a href="https://blog.debao.me/categories/legal.html">Legal</a></li>
        <li><a href="https://blog.debao.me/categories/python.html">Python</a></li>
        <li><a href="https://blog.debao.me/categories/qt.html">Qt</a></li>
        <li><a href="https://blog.debao.me/categories/science.html">Science</a></li>
        <li><a href="https://blog.debao.me/categories/sem.html">SEM</a></li>
        <li><a href="https://blog.debao.me/categories/tools.html">Tools</a></li>
    </ul>
  </section>
 

  <section>
  <h1>Tags</h1>
    <a href="https://blog.debao.me/tags/python.html">Python</a>,    <a href="https://blog.debao.me/tags/pyside.html">pyside</a>,    <a href="https://blog.debao.me/tags/qt.html">Qt</a>,    <a href="https://blog.debao.me/tags/c.html">C++</a>,    <a href="https://blog.debao.me/tags/pelican.html">pelican</a>,    <a href="https://blog.debao.me/tags/vtk.html">vtk</a>,    <a href="https://blog.debao.me/tags/sem.html">SEM</a>,    <a href="https://blog.debao.me/tags/cmake.html">cmake</a>,    <a href="https://blog.debao.me/tags/qmake.html">qmake</a>,    <a href="https://blog.debao.me/tags/cax.html">CAx</a>,    <a href="https://blog.debao.me/tags/latex.html">latex</a>,    <a href="https://blog.debao.me/tags/markdown.html">markdown</a>,    <a href="https://blog.debao.me/tags/pandoc.html">pandoc</a>,    <a href="https://blog.debao.me/tags/katex.html">katex</a>,    <a href="https://blog.debao.me/tags/vscode.html">vscode</a>,    <a href="https://blog.debao.me/tags/cad.html">cad</a>,    <a href="https://blog.debao.me/tags/stm32.html">STM32</a>,    <a href="https://blog.debao.me/tags/git.html">Git</a>,    <a href="https://blog.debao.me/tags/arm.html">ARM</a>,    <a href="https://blog.debao.me/tags/fpga.html">FPGA</a>,    <a href="https://blog.debao.me/tags/questa.html">Questa</a>,    <a href="https://blog.debao.me/tags/quartus.html">Quartus</a>,    <a href="https://blog.debao.me/tags/eda.html">EDA</a>,    <a href="https://blog.debao.me/tags/opengl.html">opengl</a>,    <a href="https://blog.debao.me/tags/coroutine.html">coroutine</a>,    <a href="https://blog.debao.me/tags/ui.html">ui</a>,    <a href="https://blog.debao.me/tags/javascript.html">javascript</a>,    <a href="https://blog.debao.me/tags/nodejs.html">nodejs</a>,    <a href="https://blog.debao.me/tags/web.html">web</a>,    <a href="https://blog.debao.me/tags/crypto.html">crypto</a>,    <a href="https://blog.debao.me/tags/rsa.html">rsa</a>,    <a href="https://blog.debao.me/tags/der.html">der</a>,    <a href="https://blog.debao.me/tags/openssl.html">openssl</a>,    <a href="https://blog.debao.me/tags/css.html">css</a>,    <a href="https://blog.debao.me/tags/scss.html">scss</a>,    <a href="https://blog.debao.me/tags/ci.html">CI</a>,    <a href="https://blog.debao.me/tags/github.html">github</a>,    <a href="https://blog.debao.me/tags/gitlab.html">gitlab</a>,    <a href="https://blog.debao.me/tags/joomla.html">Joomla</a>,    <a href="https://blog.debao.me/tags/qthread.html">QThread</a>,    <a href="https://blog.debao.me/tags/sdl.html">SDL</a>,    <a href="https://blog.debao.me/tags/qt-macros.html">Qt-Macros</a>,    <a href="https://blog.debao.me/tags/octopress.html">octopress</a>,    <a href="https://blog.debao.me/tags/qt4.html">Qt4</a>  </section>


    <section>
        <h1>Social</h1>
        <ul>
            <li><a href="https://blog.debao.me/feeds/atom.xml" type="application/atom+xml" rel="alternate">Atom</a></li>
            <li><a href="https://github.com/dbzhang800" target="_blank">github</a></li>
            <li><a href="https://www.zhihu.com/people/dbzhang800" target="_blank">zhihu</a></li>
            <li><a href="https://blog.csdn.net/dbzhang800" target="_blank">csdn</a></li>
        </ul>
    </section>

</aside>    </div>
  </div>
  <footer role="contentinfo"><p>
    Copyright &copy;  2010&ndash;2025  Debao Zhang &mdash;
  <span class="credit">Powered by <a href="http://getpelican.com">Pelican</a></span>
</p></footer>
  <script src="https://blog.debao.me/theme/js/modernizr-2.0.js"></script>
  <script src="https://blog.debao.me/theme/js/ender.js"></script>
  <script src="https://blog.debao.me/theme/js/octopress.js" type="text/javascript"></script>
</body>
</html>