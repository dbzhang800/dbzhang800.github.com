<!DOCTYPE html>
<html class="no-js" lang="en">
<head>

  <title>Node.js 学习笔记（一） &mdash; 1+1=10</title>
  <meta charset="utf-8" />
  <meta name="generator" content="Pelican" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="author" content="Debao Zhang">
    <meta name="description" content="记记笔记，放松一下..." />
    <link href="https://blog.debao.me/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="1+1=10 Full Atom Feed" />
    <link href="https://blog.debao.me/feeds/atom.xml" type="application/atom+xml" rel="alternate" title="1+1=10 Atom Feed" />
    <link href="https://blog.debao.me/feeds/javascript.atom.xml" type="application/atom+xml" rel="alternate" title="1+1=10 Categories Atom Feed" />

    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" crossorigin="anonymous">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" crossorigin="anonymous"></script>
    <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN" || mathElements[i].tagName === "DIV") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
    </script>





  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">


    <link href="https://blog.debao.me/favicon.png" rel="icon">

  <link href="https://blog.debao.me/theme/css/main.css" media="screen, projection"
        rel="stylesheet" type="text/css">

</head>

<body>
  <header role="banner"><hgroup>
  <h1><a href="https://blog.debao.me/">1+1=10</a></h1>
    <h2>记记笔记，放松一下...</h2>
</hgroup></header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="https://blog.debao.me/feeds/atom.xml" rel="subscribe-atom">Atom</a></li>
</ul>

<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="blog.debao.me">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>

<ul class="main-navigation">
</ul></nav>
  <div id="main">
    <div id="content">
<div>
  <article class="hentry" role="article">
<header>
      <h1 class="entry-title">Node.js 学习笔记（一）</h1>
    <p class="meta">
<time datetime="2024-01-25T23:16:00+08:00" pubdate>Thu 25 January 2024</time>    </p>
</header>

  <div class="entry-content"><p>接前面<a href="https://blog.debao.me/2024/01/javascript-learning-notes-4/">JavaScript基础学习</a>，了解一下Node.js。是什么，如何安装，如何简单使用</p>
<h2 id="nodejs">Node.js 是什么？</h2>
<h3 id="_1">先学习历史：</h3>
<ul>
<li>2009年5月： Ryan Dahl发布了基于V8 JavaScript引擎的Node.js，使JavaScript在服务器端运行成为可能。</li>
<li>2010年： 引入事件循环（Event Loop）作为核心特性，提供更稳定的API和模块。</li>
<li>2011年： 支持Windows平台，并引入npm（Node Package Manager）作为包管理工具。</li>
<li>2012年： Ryan Dahl离开Node.js社区。0.8.0和0.10.0版本推出，增强性能并引入更多特性。</li>
<li>2015年： io.js与Node.js合并，重新统一社区并促进更多发展。Node.js基金会成立。</li>
<li>2019年：Node.js基金会和JS基金会，组合成OpenJS基金会。</li>
<li>...</li>
</ul>
<h3 id="nodejs_1">可是Node.js到底是什么？</h3>
<p>说真的，看过几次这段话：</p>
<blockquote>
<p>Node.js是一个基于Chrome V8引擎的JavaScript运行环境，用于构建高性能、可伸缩的网络应用。它采用事件驱动、非阻塞I/O模型，使得能够处理大量并发连接。</p>
</blockquote>
<p>但看完，还是不知道Node.js是什么东西。可能对.js这个东西误解太深了，压根没去想它是可以和CPython对标的东西：</p>
<table>
<thead>
<tr>
<th>-</th>
<th>Node.js</th>
<th>CPython</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>创建时间</strong></td>
<td>2009年5月</td>
<td>1991年</td>
</tr>
<tr>
<td><strong>编程语言</strong></td>
<td>JavaScript</td>
<td>Python</td>
</tr>
<tr>
<td><strong>并发性和异步编程</strong></td>
<td>非阻塞、事件驱动，适用于处理大量并发连接</td>
<td>通过asyncio支持异步编程</td>
</tr>
<tr>
<td><strong>多线程支持</strong></td>
<td>单线程，通过事件循环和异步编程处理并发</td>
<td>多线程编程，受GIL限制，不适用于CPU密集型任务</td>
</tr>
<tr>
<td><strong>包管理</strong></td>
<td><strong>npm</strong>（Node Package Manager，创建于2010年）</td>
<td><strong>pip</strong>（Python Package Installer，创建于2003年）</td>
</tr>
<tr>
<td><strong>框架和库</strong></td>
<td>Express.js、React.js等</td>
<td>Django、Flask、NumPy、Pandas等</td>
</tr>
<tr>
<td><strong>其他</strong></td>
<td>JavaScript前后端都可以使用，全栈开发方便</td>
<td>广泛用于各种领域，特别在数据科学和机器学习</td>
</tr>
</tbody>
</table>
<blockquote>
<p>Python通常用于服务器端编程，而JavaScript在Node.js出现之前一直是主要用于客户端（浏览器）脚本的语言。Node.js使得可以将JavaScript用于服务器端开发，让开发者可以使用相同的语言在前端和后端编写代码。</p>
</blockquote>
<h2 id="_2">走马观花</h2>
<p>快速过一下，找找感觉</p>
<h3 id="_3">安装</h3>
<p>Node.js安装和python一样简单，<a href="https://nodejs.org">官网</a>下载，双击安装。而后控制台验证</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div><pre><span></span><code>$<span class="w"> </span>node<span class="w"> </span>-v
v20.10.0
$<span class="w"> </span>npm<span class="w"> </span>-v
<span class="m">10</span>.2.3
</code></pre></div></td></tr></table></div>

<h3 id="_4">使用</h3>
<p>简单看看怎么用的</p>
<h4 id="repl">REPL</h4>
<p>和Python一样，Node.js的交互式操作可以通过 REPL（Read-Eval-Print Loop）进行：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span></pre></div></td><td class="code"><div><pre><span></span><code>$<span class="w"> </span>node
Welcome<span class="w"> </span>to<span class="w"> </span>Node.js<span class="w"> </span>v20.10.0.
Type<span class="w"> </span><span class="s2">&quot;.help&quot;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>more<span class="w"> </span>information.
&gt;<span class="w"> </span><span class="s2">&quot;1&quot;</span>+3
<span class="s1">&#39;13&#39;</span>
&gt;<span class="w"> </span><span class="m">2</span>**3
<span class="m">8</span>
&gt;<span class="w"> </span>Math.sin<span class="o">(</span>Math.PI/2<span class="o">)</span>
<span class="m">1</span>
&gt;
</code></pre></div></td></tr></table></div>

<blockquote>
<p>别的先不说，电脑上又多了一个计算器，是真的</p>
</blockquote>
<h4 id="hello-world">Hello world</h4>
<p>像python一样，先写个脚本：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">// a.js</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Hello world!&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>

<p>而后执行</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code>$<span class="w"> </span>node<span class="w"> </span>a.js
Hello<span class="w"> </span>World!
</code></pre></div></td></tr></table></div>

<p>和python不太一样，<code>#</code>是python的注释符，但在javascript中不用于注释。</p>
<p>尽管如此，在第一行加入 shebang（也称 hashbang）是可以的：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="ch">#!/usr/bin/env node</span>

<span class="c1">// a.js</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Hello World!&quot;</span><span class="p">);</span>
</code></pre></div></td></tr></table></div>

<h3 id="_5">模块使用</h3>
<p>使用 http 模块，开启一个监听3000端口的http server：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">// server.mjs</span>

<span class="k">import</span><span class="w"> </span><span class="nx">http</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;http&#39;</span><span class="p">;</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">((</span><span class="nx">req</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">res</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mf">200</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s1">&#39;Content-Type&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;text/plain&#39;</span><span class="p">});</span>
<span class="w">  </span><span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="s1">&#39;Hello, 1+1=10!&#39;</span><span class="p">);</span>
<span class="p">});</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">PORT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">3000</span><span class="p">;</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">PORT</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Server running at http://localhost:</span><span class="si">${</span><span class="nx">PORT</span><span class="si">}</span><span class="sb">/`</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div></td></tr></table></div>

<blockquote>
<p>在<a href="https://blog.debao.me/2024/01/javascript-learning-notes-4/">JavaScript模块学习</a>简单认识了CommonJS和ESM模块区别，以及.mjs、.cjs和.js后缀。为简单起见，完全不去碰CommonJS。</p>
</blockquote>
<h3 id="_6">模块安装</h3>
<p>安装express</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>npm<span class="w"> </span>install<span class="w"> </span>express
</code></pre></div></td></tr></table></div>

<p>而后使用其监听3000端口：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">// server.mjs</span>
<span class="k">import</span><span class="w"> </span><span class="nx">express</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;express&#39;</span><span class="p">;</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">app</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">express</span><span class="p">();</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">PORT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">3000</span><span class="p">;</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s1">&#39;Hello 1+1=10!&#39;</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">PORT</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Server running at http://localhost:</span><span class="si">${</span><span class="nx">PORT</span><span class="si">}</span><span class="sb">/`</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div></td></tr></table></div>

<h2 id="packagejson">package.json</h2>
<p><code>package.json</code> 是 Node.js 项目中的配置文件，用于定义项目的元数据、依赖关系以及一些执行脚本。类比到Python中，可能和setup.py有一点点像似。</p>
<p>package.json简单的例子：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;your-package&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1.0.0&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;main&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;index.mjs&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;scripts&quot;</span><span class="p">:</span><span class="w"> </span>
<span class="w">    </span><span class="nt">&quot;start&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;node index.mjs&quot;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>

<ul>
<li><code>main</code> 字段用于指定项目的主要入口文件。当其他人使用这个包作为依赖时，Node.js 会默认加载这个文件。</li>
<li><code>scripts</code> 中的 "start" 的脚本，主要由 <code>nodemon</code> 使用，以便于实现自动重启。</li>
</ul>
<h3 id="_7">虚拟环境？</h3>
<p>有点类似python中的venv虚拟环境，而后pip安装的包在虚拟环境中。如下命令会创建一个package.json文件：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>npm init -y
</code></pre></div></td></tr></table></div>

<p>而后 npm 安装包会在项目目录下</p>
<h3 id="nodemon">nodemon</h3>
<blockquote>
<p><code>nodemon</code> 是一个用于监视 Node.js 应用程序中文件更改并自动重启应用的工具。它可以在控制台中运行，监听指定的文件，当这些文件发生变化时，<code>nodemon</code> 会自动重启应用，而无需手动重新启动应用。</p>
</blockquote>
<p>安装方式：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>npm<span class="w"> </span>install<span class="w"> </span>-g<span class="w"> </span>nodemon
</code></pre></div></td></tr></table></div>

<blockquote>
<p>选项 <code>-g</code> 代表全局安装（global install）</p>
</blockquote>
<p>使用：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>nodemon<span class="w"> </span>index.mjs
</code></pre></div></td></tr></table></div>

<p>或直接让其使用package.json中通过 scripts 指定的start脚本：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>nodemon
</code></pre></div></td></tr></table></div>

<p>注意，Node v16开始，提供了命令行选项 <code>--watch</code>，在一定程序上，可以取代nodemon功能：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>node<span class="w"> </span>--watch<span class="w"> </span>index.mjs
</code></pre></div></td></tr></table></div>

<h2 id="webpack">Webpack</h2>
<h3 id="_8">安装</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code>npm<span class="w"> </span>init<span class="w"> </span>-y
npm<span class="w"> </span>install<span class="w"> </span>webpack<span class="w"> </span>webpack-cli<span class="w"> </span>--save-dev
</code></pre></div></td></tr></table></div>

<ul>
<li><code>--save-dev</code> 用于将包添加到项目的开发依赖项（devDependencies）中。这意味着这个包在项目运行时并不是必需的，但在开发、构建或测试阶段是必需的。</li>
</ul>
<h3 id="_9">例子</h3>
<p>准备两个源文件：</p>
<ul>
<li>src/index.mjs</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Hello 1+1=10&quot;</span><span class="p">;</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>
</code></pre></div></td></tr></table></div>

<ul>
<li>index.html</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&quot;en&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;module&quot;</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;dist/main.mjs&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></div></td></tr></table></div>

<p>准备webpack配置文件webpack.config.mjs：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">fileURLToPath</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;node:url&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="nx">path</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;node:path&#39;</span><span class="p">;</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">dist</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fileURLToPath</span><span class="p">(</span><span class="ow">new</span><span class="w"> </span><span class="nx">URL</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">import</span><span class="p">.</span><span class="nx">meta</span><span class="p">.</span><span class="nx">url</span><span class="p">))</span><span class="o">+</span><span class="s1">&#39;dist&#39;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">entry</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;./src/index.mjs&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">output</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">filename</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;main.mjs&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">path</span><span class="o">:</span><span class="w"> </span><span class="nx">dist</span><span class="p">,</span>
<span class="w">  </span><span class="p">},</span>
<span class="p">};</span>
</code></pre></div></td></tr></table></div>

<blockquote>
<p>path必须用绝对路径，这个在ESM下似乎还不好弄。</p>
</blockquote>
<p>运行它</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>npx webpack  --mode production
</code></pre></div></td></tr></table></div>

<p>效果：src/index.mjs 被拷贝到 dist/main.mjs，而后，可以通过 html页面看效果</p>
<blockquote>
<p><code>npx</code> 是 Node.js 包自带的一个工具，它允许你直接运行在 <code>node_modules/.bin</code> 目录下安装的可执行文件。换言之，<code>npx</code> 提供了一种方便的方式来执行本地或远程的命令行工具，而不必手动安装或配置这些工具。</p>
</blockquote>
<p>如果不像敲npx，也可以：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>npm run build
</code></pre></div></td></tr></table></div>

<p>前提是需要package.json中添加</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nt">&quot;scripts&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;build&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;webpack --mode production&quot;</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>

<h3 id="_10">疑问？</h3>
<p>官方说：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nv">Out</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">box</span>,<span class="w"> </span><span class="nv">webpack</span><span class="w"> </span><span class="nv">won</span><span class="err">&#39;t require you to use a configuration file. However, it will assume the entry point of your project is src/index.js and will output the result in dist/main.js minified and optimized for production.</span>
</code></pre></div></td></tr></table></div>

<p>翻译过来：webpack的配置文件不是必须的，它假定入口点是src/index.js，输出是dist/main.js。</p>
<p>对我们的例子，因为用的.mjs，如果去掉配置文件，会报错...</p>
<p>对于初学JavaScript，又不想用CommonJS，只想用ESM格式的人来说，有点水土不服。</p>
<h2 id="_11">其他操作</h2>
<p>网络上资料以CJS为主，用ESM模块的话...</p>
<h3 id="_12">获取当前工作目录</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">cwd</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;node:process&#39;</span><span class="p">;</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">currentWorkingDirectory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cwd</span><span class="p">();</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Current Working Directory:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">currentWorkingDirectory</span><span class="p">);</span>
</code></pre></div></td></tr></table></div>

<h3 id="_13">获取脚本路径</h3>
<ul>
<li><code>import.meta.url</code> 是一个特殊的元数据对象，用于获取当前模块的 URL。</li>
<li><code>fileURLToPath</code> 函数用于将 URL 转换为文件路径。这个东西很关键（URL.pathname不好使）。</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nx">url</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;node:url&#39;</span><span class="p">;</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">import</span><span class="p">.</span><span class="nx">meta</span><span class="p">.</span><span class="nx">url</span><span class="p">);</span><span class="w"> </span><span class="c1">// file:///e:/debao-js-tt/mytest.mjs</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="ow">new</span><span class="w"> </span><span class="nx">URL</span><span class="p">(</span><span class="k">import</span><span class="p">.</span><span class="nx">meta</span><span class="p">.</span><span class="nx">url</span><span class="p">).</span><span class="nx">pathname</span><span class="p">);</span><span class="w"> </span><span class="c1">// /e:/debao-js-tt/mytest.mjs</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">url</span><span class="p">.</span><span class="nx">fileURLToPath</span><span class="p">(</span><span class="k">import</span><span class="p">.</span><span class="nx">meta</span><span class="p">.</span><span class="nx">url</span><span class="p">));</span><span class="w"> </span><span class="c1">// e:\debao-js-tt\mytest.mjs</span>

<span class="k">import</span><span class="w"> </span><span class="nx">path</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;node:path&#39;</span><span class="p">;</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">currentScriptPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">url</span><span class="p">.</span><span class="nx">fileURLToPath</span><span class="p">(</span><span class="k">import</span><span class="p">.</span><span class="nx">meta</span><span class="p">.</span><span class="nx">url</span><span class="p">);</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">currentScriptDirectory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">dirname</span><span class="p">(</span><span class="nx">currentScriptPath</span><span class="p">);</span><span class="w"> </span><span class="c1">// e:\debao-js-tt</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Current Script Directory:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">currentScriptDirectory</span><span class="p">);</span>
</code></pre></div></td></tr></table></div>

<h2 id="_14">参考</h2>
<ul>
<li>https://nodejs.org/en</li>
<li>https://en.wikipedia.org/wiki/Node.js</li>
<li>https://nodemon.io/</li>
<li>https://webpack.js.org/configuration</li>
</ul></div>
    <footer>
<p class="meta">
  <span class="byline author vcard">
    Posted by <span class="fn">
        Debao Zhang
    </span>
  </span>
<time datetime="2024-01-25T23:16:00+08:00" pubdate>Thu 25 January 2024</time>  <span class="categories">
    <a class='category' href='https://blog.debao.me/categories/javascript.html'>JavaScript</a>
  </span>
  <span class="categories">
    <a class="category" href="https://blog.debao.me/tags/nodejs.html">nodejs</a>  </span>
</p><div class="sharing">
</div>    </footer>
  </article>

</div>
<aside class="sidebar">
  <section>
    <h1>Recent Posts</h1>
    <ul id="recent_posts">
      <li class="post">
          <a href="https://blog.debao.me/2025/02/notes-on-bpm/">BPM 小记</a>
      </li>
      <li class="post">
          <a href="https://blog.debao.me/2025/01/a-brief-note-on-semiconductor-memory-terminology/">半导体存储器术语小记</a>
      </li>
      <li class="post">
          <a href="https://blog.debao.me/2025/01/notes-on-yizhuang-bda-and-e-town/">亦庄、经开区、亦庄新城备忘</a>
      </li>
      <li class="post">
          <a href="https://blog.debao.me/2025/01/freecad-learning-notes-2/">FreeCAD学习小记（二）</a>
      </li>
      <li class="post">
          <a href="https://blog.debao.me/2025/01/what-is-document-no.-37/">37号文是个啥？</a>
      </li>
    </ul>
  </section>
  <section>
      
    <h1>Categories</h1>
    <ul id="recent_posts">
        <li><a href="https://blog.debao.me/categories/c.html">C++</a></li>
        <li><a href="https://blog.debao.me/categories/cax.html">CAx</a></li>
        <li><a href="https://blog.debao.me/categories/ee.html">EE</a></li>
        <li><a href="https://blog.debao.me/categories/esl.html">ESL</a></li>
        <li><a href="https://blog.debao.me/categories/javascript.html">JavaScript</a></li>
        <li><a href="https://blog.debao.me/categories/legal.html">Legal</a></li>
        <li><a href="https://blog.debao.me/categories/python.html">Python</a></li>
        <li><a href="https://blog.debao.me/categories/qt.html">Qt</a></li>
        <li><a href="https://blog.debao.me/categories/science.html">Science</a></li>
        <li><a href="https://blog.debao.me/categories/sem.html">SEM</a></li>
        <li><a href="https://blog.debao.me/categories/tools.html">Tools</a></li>
    </ul>
  </section>
 

  <section>
  <h1>Tags</h1>
    <a href="https://blog.debao.me/tags/python.html">Python</a>,    <a href="https://blog.debao.me/tags/pyside.html">pyside</a>,    <a href="https://blog.debao.me/tags/qt.html">Qt</a>,    <a href="https://blog.debao.me/tags/c.html">C++</a>,    <a href="https://blog.debao.me/tags/pelican.html">pelican</a>,    <a href="https://blog.debao.me/tags/vtk.html">vtk</a>,    <a href="https://blog.debao.me/tags/sem.html">SEM</a>,    <a href="https://blog.debao.me/tags/cmake.html">cmake</a>,    <a href="https://blog.debao.me/tags/qmake.html">qmake</a>,    <a href="https://blog.debao.me/tags/cax.html">CAx</a>,    <a href="https://blog.debao.me/tags/latex.html">latex</a>,    <a href="https://blog.debao.me/tags/markdown.html">markdown</a>,    <a href="https://blog.debao.me/tags/pandoc.html">pandoc</a>,    <a href="https://blog.debao.me/tags/katex.html">katex</a>,    <a href="https://blog.debao.me/tags/vscode.html">vscode</a>,    <a href="https://blog.debao.me/tags/cad.html">cad</a>,    <a href="https://blog.debao.me/tags/stm32.html">STM32</a>,    <a href="https://blog.debao.me/tags/git.html">Git</a>,    <a href="https://blog.debao.me/tags/arm.html">ARM</a>,    <a href="https://blog.debao.me/tags/fpga.html">FPGA</a>,    <a href="https://blog.debao.me/tags/questa.html">Questa</a>,    <a href="https://blog.debao.me/tags/quartus.html">Quartus</a>,    <a href="https://blog.debao.me/tags/eda.html">EDA</a>,    <a href="https://blog.debao.me/tags/opengl.html">opengl</a>,    <a href="https://blog.debao.me/tags/coroutine.html">coroutine</a>,    <a href="https://blog.debao.me/tags/ui.html">ui</a>,    <a href="https://blog.debao.me/tags/javascript.html">javascript</a>,    <a href="https://blog.debao.me/tags/nodejs.html">nodejs</a>,    <a href="https://blog.debao.me/tags/web.html">web</a>,    <a href="https://blog.debao.me/tags/crypto.html">crypto</a>,    <a href="https://blog.debao.me/tags/rsa.html">rsa</a>,    <a href="https://blog.debao.me/tags/der.html">der</a>,    <a href="https://blog.debao.me/tags/openssl.html">openssl</a>,    <a href="https://blog.debao.me/tags/css.html">css</a>,    <a href="https://blog.debao.me/tags/scss.html">scss</a>,    <a href="https://blog.debao.me/tags/ci.html">CI</a>,    <a href="https://blog.debao.me/tags/github.html">github</a>,    <a href="https://blog.debao.me/tags/gitlab.html">gitlab</a>,    <a href="https://blog.debao.me/tags/joomla.html">Joomla</a>,    <a href="https://blog.debao.me/tags/qthread.html">QThread</a>,    <a href="https://blog.debao.me/tags/sdl.html">SDL</a>,    <a href="https://blog.debao.me/tags/qt-macros.html">Qt-Macros</a>,    <a href="https://blog.debao.me/tags/octopress.html">octopress</a>,    <a href="https://blog.debao.me/tags/qt4.html">Qt4</a>  </section>


    <section>
        <h1>Social</h1>
        <ul>
            <li><a href="https://blog.debao.me/feeds/atom.xml" type="application/atom+xml" rel="alternate">Atom</a></li>
            <li><a href="https://github.com/dbzhang800" target="_blank">github</a></li>
            <li><a href="https://www.zhihu.com/people/dbzhang800" target="_blank">zhihu</a></li>
            <li><a href="https://blog.csdn.net/dbzhang800" target="_blank">csdn</a></li>
        </ul>
    </section>

</aside>    </div>
  </div>
  <footer role="contentinfo"><p>
    Copyright &copy;  2010&ndash;2025  Debao Zhang &mdash;
  <span class="credit">Powered by <a href="http://getpelican.com">Pelican</a></span>
</p></footer>
  <script src="https://blog.debao.me/theme/js/modernizr-2.0.js"></script>
  <script src="https://blog.debao.me/theme/js/ender.js"></script>
  <script src="https://blog.debao.me/theme/js/octopress.js" type="text/javascript"></script>
</body>
</html>